load("@bazel-erlang//:ct.bzl", "ct_test")
load("//:rabbitmq.bzl", "rabbitmq_lib")

APP_ENV = """[
	    {rates_mode,        basic},
	    {sample_retention_policies,
	     %% List of {MaxAgeInSeconds, SampleEveryNSeconds}
	     [{global,   [{605, 5}, {3660, 60}, {29400, 600}, {86400, 1800}]},
	      {basic,    [{605, 5}, {3600, 60}]},
	      {detailed, [{605, 5}]}]}
	  ]"""

rabbitmq_lib(
    app_name = "rabbitmq_management_agent",
    app_description = "RabbitMQ Management Agent",
    app_module = "rabbit_mgmt_agent_app",
    app_env = APP_ENV,
    extra_apps = [
        "xmerl",
        "mnesia",
        "ranch",
        "ssl",
        "crypto",
        "public_key",
    ],
    priv = glob(["priv/**/*"]),
    deps = [
        "//deps/rabbit_common:bazel_erlang_lib",
        "//deps/rabbit:bazel_erlang_lib",
        "@lager//:bazel_erlang_lib", # again this should probably come via rabbit_common
    ],
)
